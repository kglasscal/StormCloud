---
title: "StormCloud: The Human and Economic Toll from U.S. Storms"
author: "Kevin Glass"
date: "`r Sys.Date()`"
output:
  html_document:
    toc:             true
    toc_depth:       3
    number_sections: true    
    toc_float:
      toc_collapsed: true
    theme:           united
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Synopsis

# Code

## Introduction

The StormCloud code is complex and long; the uncommented base code is around 400 lines and the testing code (shown in the Appendix 1) is another 200 lines. Some of the techniques used to produce the code have not been discussed in class as are some of the libraries. As a result, the code will include extensive 

The


## Setup Phase
The Setup Phase is partitioned into four sections. The 


### StormCloud Libraries COMMENT


```{r setup phase, message=FALSE}

library(ggplot2)
library(dplyr)
library(cowplot)
library(knitr)
library(kableExtra)
```

### User Defined Constants
StormCloud gives the user control over the location and name of the required resource file. It also allows the user to select to select a state and county for more detailed analysis of the storm data.

```{r user defined constants}
URL      = 
  "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
DATAFILE = "storm.csv.bz2"

STATE_    <- "CA"
COUNTY_   <- "SAN BERNARDINO"

```

### Testing Constants
The following set of constants are used for debugging, testing, and notifying the user about the status of the programs execution. When running the code to produce useful output, all of these constants are set to FALSE.

```{r test constants}
VERBOSE                    = FALSE     # TRUE  FALSE
DEBUG                      = TRUE
TEST                       = TRUE
SYSTEM                     = FALSE

ALL_FUNCTIONS              = FALSE
MAIN                       = FALSE
MAKE_STORM_COST_TABLES     = FALSE
DOWNLOAD_DATA_FILE         = FALSE
LOAD_STORM_COST_DATA       = FALSE
CLEAN_RAW_DATA             = FALSE
TRANSFORM_RAW_TO_BASE      = FALSE
MAKE_BASE_TABLE_LIST       = FALSE
GET_HUMAN_COST             = TRUE
GET_ECONOMIC_COST          = FALSE
MERGE_STORM_LIST           = FALSE
MAKE_JURIS_MERGE_LIST      = FALSE
MAKE_JURIS_MERGED_TABLE    = FALSE

MAKE_STORM_COST_ANALYSIS   = FALSE
MAKE_TOP10_HUMAN_TABLE     = FALSE
MAKE_TOP10_ECONOMCIC_TABLE = FALSE
MAKE_CVC_IMAGE             = FALSE

PHASE_SETUP                = FALSE
PHASE_MAKE_DATA            = FALSE
PHASE_ANALYSIS             = FALSE
PHASE_CONTROL              = FALSE

DISPLAY_OUTPUT             = FALSE
```

### Program Constants
The program constants are used to make the code less cryptic. Rather than using numbers to define array indices, loop ranges, and other invariant values, StormCloud uses named constants. For example, the function MakeBaseTableList, uses a for loop with the range CNTY_BASE_IDX through US_BASE_IDX rather than 1 through 3. When the programmer knows the names of the constants, he or she does not need to remember which number represents which thing.

```{r program constants}

# All of the jurisdiction data (county, state, and U.S.) are stored in a 
# a jurisStormTable

EXECUTE           = 0
CNTY_BASE_IDX     = 1
ST_BASE_IDX       = 2
US_BASE_IDX       = 3
CNTY_HUMAN_IDX    = 4
ST_HUMAN_IDX      = 5
US_HUMAN_IDX      = 6
CTNY_ECON_IDX     = 7
ST_ECON_IDX       = 8
US_ECON_IDX       = 9

HUMAN_OFF         = 3        
ECON_OFF          = 6        

REGION_NAME = c('COUNTY', 'STATE', 'US',   
                'COUNTY_HUMAN_COST', 'STATE_HUMAN_COST', 
                'US_HUMAN_COST', 'COUNTY_ECON_COST', 
                'STATE_ECON_COST', 'US_ECON_COST')

# These constants are the column names for the final data frames
COUNTY_FIELD   <- 
  "c('EVTYPE', 'STATE', 'COUNTY', 'HUMAN_COST', 'ECON_COST')"
STATE_FIELD    <- 
  "c('EVTYPE', 'STATE', 'HUMAN_COST', 'ECON_COST')"
US_FIELD  <- 
  "c('EVTYPE', 'HUMAN_COST', 'ECON_COST')"

JURIS_FIELD     <- list(COUNTY_FIELD, STATE_FIELD, US_FIELD)

JURIS_FILTER    <-  list( 
  ".$'COUNTY' == COUNTY_ & .$'STATE' == STATE_",
  ".$'STATE' == STATE_",
  NULL
) # end JURIS_FILTER

```


<!-- 6789112345678921234567893123456789412345678951234567896123456789 -->
<!-- 
## 456789112345678921234567893123456789412345678951234567896123456789
 -->

## Program Control Phase

```{r program control phase}
Main <- function(url, datafile) {
  jurisTableList  <- MakeStormCostTables(url, datafile)
  resultList      <- MakeStormCostAnalysis(jurisTableList)
  
  if (VERBOSE) {
    print("That's all folks")
  }

  return (resultList)
}

```

## Make Data Frames Phase

### Make Storm Cost Tables

```{r make analysis phase}
## 456789112345678921234567893123456789412345678951234567896123456789
# MakeStormCostTables ############################################
MakeStormCostTables <- function(url, dataFile)  {
  if (VERBOSE & MAKE_STORM_COST_TABLES) {
    print("MakeStormCostTables(): coordinate the generation of ")
    print("the jurisTableList from the origional source file")
  }
  
  # If the data file is not in the project directory, download it ---  
  if (!file.exists(dataFile)) {
    DownloadDataFile(url, destfile)
  } else {
    if (VERBOSE & MAKE_STORM_COST_TABLES) {
      print(paste0(dataFile, " Contents already loaded "))
    }
  }

  rawData <- LoadStormCostData(dataFile)
  ## Set up the aggregated financial and casualty data  -------------
  baseData <- TransformRawToBase(rawData)
  
  baseTableList   <- MakeBaseTableList(baseData)
  jurisTableList  <- MakeJurisMergedTable(baseTableList)
  
  return (jurisTableList)
}  ## End of MakeStormCostTables function

```

### Download Data File

```{r}

# DownloadDataFile ##################################################
DownloadDataFile <- function(url, destfile)
{
  if (VERBOSE & DOWNLOAD_DATA_FILE) {
    print(paste0("downloadDataFile: Download ", destfile, " from\n", url))
  }

  retrieve = download.file(url, destfile, mode = "wb")
  if (is.null(retrieve)) {
    print("ERROR: could not access ", url)
    stop()
  }
}  ## End of DownloadDataFile function

```

```{r}

# LoadStormCostData ##################################################
# COUNTYNAME STATE  EVTYPE FATALITIES INJURIES PROPDMG PROPDMGEXP CROPDMG
LoadStormCostData <- function(dataFile)
{
  if ((VERBOSE | DEBUG) & LOAD_STORM_COST_DATA) {
    print(paste0("loadRawData: Reading raw storm data from ", 
                 dataFile))
  }

  ## set up table from the input file -------------------------------
  rawData <- read.table(dataFile, stringsAsFactors = FALSE, 
                        sep = ",",
                        colClasses = c(rep("NULL",5), NA, NA, NA, 
                                       rep("NULL",14), rep(NA, 6), 
                                       rep("NULL",9)),
                        header = TRUE)
  if(is.null(rawData)) {
    print(paste0("ERROR: could not read ", dataFile))
    stop()
  }
  
  if ((VERBOSE | DEBUG) & LOAD_STORM_COST_DATA) {
    print("LoadStormCostData: Display raw data ")
    print(head(rawData))
  }
  
  rawData <- ConsolidateStormTypes(rawData)
  
  return (rawData)
}  ## End of LoadStormCostData function

```

```{r}

# CleanRawData ######################################################
CleanRawData <- function(rawData)
{
  if ((VERBOSE | DEBUG) & CLEAN_RAW_DATA) {
    print("CleanRawData: Set headers, transform data to numeric ")
    print(head(rawData))
  }

 ## convert data used for computation from string to numeric --------
  rawData <- rawData %>%
    mutate_at(c('FATALITIES', 'INJURIES', 'PROPDMG', 'CROPDMG'), 
              as.numeric)

  rawData <- ConsolidateStormTypes(rawData)

  if ((VERBOSE | DEBUG) & CLEAN_RAW_DATA) {
    print("CleanRawData: check raw data")
    print(head(rawData))
  }
  return (rawData)
}  ## End of CleanRawData function

```

```{r}

# CleanRawData ######################################################
ConsolidateStormTypes <- function(rawData) {
  # this will be used to create a uniform name convention
  return (rawData)
}

```
### Transform Raw to Base
```{r}

# TransformRawToBase ##############################################
TransformRawToBase <- function(rawData) 
{
  if (VERBOSE & TRANSFORM_RAW_TO_BASE) {
    print("TransformRawToBase: aggregate economic and human costs")
  }

  baseData <- rawData %>% ungroup(.) %>%
    mutate (PROPDMGEXP = ifelse(PROPDMGEXP == 'K', 1000.,
                                ifelse(PROPDMGEXP == 'M', 
                                       1000000., 1.) ),
            CROPDMGEXP = ifelse(CROPDMGEXP == 'K', 1000.,
                                ifelse(CROPDMGEXP == 'M', 
                                       1000000., 1.) ),
            PROPDMG       = PROPDMG * PROPDMGEXP,
            CROPDMG       = CROPDMG * CROPDMGEXP,
            FATALITIES    = FATALITIES,
            INJURIES      = INJURIES,
            HUMAN_COST    = FATALITIES + INJURIES,
            ECON_COST     = PROPDMG + CROPDMG
            ) %>% 
    select(EVTYPE, COUNTYNAME, STATE, HUMAN_COST, ECON_COST)
  
  if (DEBUG & TRANSFORM_RAW_TO_BASE) {
    print("TransformRawToBase: check data before rename")
    print(paste0("column names = ", colnames(baseData)))
    print(head(baseData))
  }

  colnames(baseData) <- eval(parse(text = COUNTY_FIELD))

  if ((VERBOSE | DEBUG) & TRANSFORM_RAW_TO_BASE) {
    print("TransformRawToBase: check data after rename")
    print(paste0("column names = ", colnames(baseData)))
    print(head(baseData))
  }

  return (baseData)
}  ## End of TransformRawToBase function

```
### Make Base Table List
```{r}

# MakeBaseTableList ###########################################
MakeBaseTableList <- function(baseData) {
  if (VERBOSE & MAKE_BASE_TABLE_LIST) {
    print("MakeBaseTableList: make base data tables for each jursidiction")
  }

  baseTableList = list()
  for (i in CNTY_BASE_IDX : US_BASE_IDX) {
    baseTable <- baseData %>%
      select(eval(parse(text = JURIS_FIELD[i])))
    
    if (DEBUG & MAKE_BASE_TABLE_LIST) {
      print(paste0("MakeBaseTableList: prior to filterbaseData[", i, "]"))
      print(paste0("column names = ", colnames(baseTable)))
      print(paste0("juris field = ", JURIS_FIELD[[i]]))
      print(paste0("juris filter = ", JURIS_FILTER[[i]]))
      print(head(baseTable, n =2))
    }

    print("PREFILTER ------------------")
    print(head(baseTable, n =2))
 
     if (!is.null(JURIS_FILTER[[i]])) {
      baseTable <- baseTable %>%
        filter(eval(parse(text = JURIS_FILTER[[i]])))
    }
   
    print("POSTFILTER ------------------")
    print(head(baseTable, n =2))
 
    if (DEBUG & MAKE_BASE_TABLE_LIST) {
      print(paste0("MakeBaseTableList: after to filterbaseData[", i, "]"))
      print(paste0("column names = ", colnames(baseTable)))
      print(paste0("juris field = ", JURIS_FIELD[[i]]))
      print(paste0("juris filter = ", JURIS_FILTER[[i]]))
      print(head(baseTable, n =2))
    }

    # this is jurisFieldTables 2-4
    baseTableList[[length(baseTableList)+1]] <- baseTable
  }

  if (VERBOSE & MAKE_BASE_TABLE_LIST) {
    print("MakeBaseTableList: check source data frames")
    print(paste0("len of base table list = ", length(baseTableList)))

    for (baseTable in baseTableList) {
      print(head(baseTable))
    }
  }

  return(baseTableList)
}  ## End of MakeBaseTableList function

```
### Get Human Cost
```{r}

# GetHumanCost ######################################################
GetHumanCost <- function(baseStorm)
{
  if (VERBOSE & GET_HUMAN_COST) {
    print("GetHumanCost: make an ordered list of human cost by ")
    print("jurisdiction")
  }
  # summarize Jurisdiction Storm Table by human cost and sort by eather
  humanCost <- baseStorm
  # stormdf <- ldply (baseStorm, data.frame)
# 
  if (DEBUG & GET_HUMAN_COST) {
    print(paste0("GetHumanCost: baseStorm type = ", class(baseStorm)))
    print(baseStorm)
  }

  # humanCost <- stormdf %>%
  #   summarise(STORM_HUMAN_COST = sum(costDF), .groups = 'drop')
  # 
  # humanCost <- humanCost %>% arrange(desc(.$EVTYPE), 
  #                                    .by_group = TRUE)
  # if (DEBUG & GET_HUMAN_COST) {
  #   
  #   print("jurisStormTable: humanCost")
  #   print(head(humanCost))
  # }
  
  return(humanCost)
} ## End of GetHumanCost function

```

```{r}

# GetEconomicCost ###################################################
GetEconomicCost <- function(baseTableList) {
  if (VERBOSE & GET_ECONOMIC_COST) {
    print("GetEconomicCost: make ordered list of economic cost by jurisdiction")
  }
  # summarize Jurisdiction Storm Table by economic cost and sort by storm
  econCost <- baseTableList %>% 
    summarise(STORM_ECON_COST  = sum(ECON_COST), .groups = 'drop')
  econCost <- econCost %>% arrange(desc(.$EVTYPE), .by_group = TRUE)
  if (DEBUG & GET_ECONOMIC_COST) {
    print("jurisStormTable: econCost")
    print(head(econCost))
  }
  return(econCost)
} ## End of GetEconomicCost function

```

```{r}

# MergedStormList ###################################################
MergeStormLists <- function(baseTableList){
  if (VERBOSE & MERGE_STORM_LIST) {
    print("MergedStormList: make an ordered list of economic cost by jurisdiction")
  }
  mergeStormList = list()
  # for (baseIdx in CNTY_BASE_IDX : US_BASE_IDX) {
  
  for (baseTbl in baseTableList) {
  #   print(head(cost))
  # }
    baseStorm <- baseTbl %>% group_by(EVTYPE)
    
    humanCost <- GetHumanCost(baseStorm)
    econCost  <- GetEconomicCost(baseStorm)
    # merge human and economic cost summaries
    storm <- merge(humanCost, econCost, 
                       by.x = c('EVTYPE'), by.y = c('EVTYPE'))

    mergeStormList[[length(mergeStormList)+1]] <- storm
  }
  
  return (mergeStormList)  
} ## End of MergedStormList function

```

```{r}

# MakeJurisMergedTable #########################################
MakeJurisMergedTable <- function(jurisTableList)  {
  if (VERBOSE & MAKE_JURIS_MERGED_TABLE) {
    print("MakeJurisMergedTable: group the rawTables to grouped ")
    print("jurisdiction tables by storm type")
  }

  mergeTableList <- MergedStormList(jurisTableList)
  # for (juris in CNTY_BASE_IDX : US_BASE_IDX) {
  #   humanOrder <- mergeTableList[[juris]] %>%
  #     arrange(desc(.$STORM_HUMAN_COST),
  #             .by_group = TRUE)
  #   jurisTableList[[length(jurisTableList)+1]] <- humanOrder
  # }
  # 
  # for (juris in CNTY_BASE_IDX : US_BASE_IDX) {
  #   costOrder  <- mergeTableList[[juris]] %>%
  #     arrange(desc(.$STORM_ECON_COST),
  #             .by_group = TRUE)
  #   jurisTableList[[length(jurisTableList)+1]] <- costOrder
  # }
  # 
  # rm (mergeTableList)

  return (mergeTableList)
}  ## End of MakeJurisMergedTable function

```

## Analysis Phase

```{r analysis phase}
# MakeStormCostAnalysis ##########################################
MakeStormCostAnalysis <- function(jurisTableList) {
  if (VERBOSE & MAKE_STORM_COST_ANALYSIS) {
    print("MakeStormCostAnalysis: group the rawTables to jurisdiction ")
    print("tables grouped by storm type")
  }
  resultList <- list()
  ## Make StormCost Tables (Top 10)
  humanCost <- MakeTop10HumanTable(jurisTableList)
  econCost  <- MakeTop10EconomicTable(jurisTableList)
  
  ## Make Human v. Economic Cost Plots
  cvcList <- MakeCvC(humanCost)
  
  resultList[[length(resultList) + 1]] <- humanCost
  resultList[[length(resultList) + 1]] <- econCost
  resultList[[length(resultList) + 1]] <- cvcList
  
  return (resultList)
}

```

```{r}

# MakeTop10HumanTable ###########################################
MakeTop10HumanTable <- function(jurisTableList) {
  if ((VERBOSE | DEBUG) & MAKE_TOP10_HUMAN_TABLE) {
    print("MakeTop10HumanTable: starting data")
    print(head(jurisTableList))
  }

  humanCostList = list()
  for (juris in CNTY_BASE_IDX : US_BASE_IDX) {
    humanCostTitle <- switch (juris, 
            paste0("Top 10 Storm Costs, (Human Costs)\n", 
                   COUNTY_, " ", STATE_),
            paste0("Top 10 Storm Costs, (Human Costs)\n",
                   state.name[grep(STATE_, state.abb)]),
            "Top 10 Storm Costs, (Human Costs\n)"
    )
    humanCostList[length(humanCostList) + 1] = humanCostTitle
    humanCostList[length(humanCostList) + 1] = 
      jurisTableList[juris + HUMAN_OFF]
  }

  return(humanCostList)
}

# MakeTop10EconomicTable ########################################
MakeTop10EconomicTable <- function(jurisTableList) {
  if ((VERBOSE | DEBUG) & MAKE_TOP10_ECONOMCIC_TABLE) {
    print("MakeTop10HumanTable: starting data")
    print(head(jurisTableList))
  }

  economicCostList = list()
  for (juris in CNTY_BASE_IDX : US_BASE_IDX) {
    economicCostTitle <- 
      switch (juris,
              paste0("Top 10 Storm Costs, (Human Costs)\n", 
                     COUNTY_, " ", STATE_),
              paste0("Top 10 Storm Costs, (Human Costs)\n",
                     state.name[grep(STATE_, state.abb)]),
              "Top 10 Storm Costs, (Human Costs\n)"
    )
    economicCostList[length(economicCostList) + 1] = economicCostTitle
    economicCostList[length(economicCostList) + 1] = 
      jurisTableList[juris + ECON_OFF]
  }

  return(economicCostList)
}
```


```{r}

makeOutputTables <- function(dataTables)
{
  tableFmt <- kbl(head(dataTable[[2]], 10)) %>%
    kable_styling(bootstrap_options = c("striped", "hover"), 
                  full_width = F, position = "left", 
                  font_size = 7)
  
 return (tableFmt)
}
```

### Make Images

```{r image phase}
MakeCvC <- function(cvcTable) {
  if ((VERBOSE | DEBUG) & MAKE_CVC_IMAGE) {
    print("MakeCvC: starting processing")
  }

  cvcImageList <- list()

  i <- 1
  for (cvcImage in cvcTable) {
    if (i %% 2 == 0) {
      df <- data.frame(cvcImage)
      # print(head(df))
      # collect plot attributes (i/2)
      sp <- ggplot(df, aes(x = STORM_HUMAN_COST, y = STORM_ECON_COST)) + geom_point()

      cvcImageList[[length(cvcImageList) + 1]] = sp
    } else {
      print(cvcImage)
    }
    i <- i + 1
  }

  return(cvcImageList)
}

```

```{r execute phase}
if (EXECUTE) {
  results <- Main(URL, DATAFILE)
  
  humanList <- results[[1]]
  econList  <- results[[2]]
  cvcList   <- results[[3]]
}

```

<hr style="background: DarkOrchid; height: 3px"/>

<!-- https://www.dofactory.com/html/hr/style#:~:text=The%20style%20attribute%20specifies%20the,or%20an%20external%20CSS%20file -->

# Results

```{r}

```
# Bibliography

# Appendix 1: Testing Phase

```{r testing phase}

# ###################################################################
test_LoadStormCostData <- function(url, datafile) {
  print("test_LoadStormCostData")
  
  rawData <- LoadStormCostData(datafile)
  
  print("test_LoadStormCostData raw data ###########################")

  print(head(rawData))
  
  print("###########################################################")

  return (rawData)
}

```

```{r}

test_CleanRawData <- function(url, datafile) {
  rawData <- LoadStormCostData(datafile)
  cleanData <- CleanRawData(rawData)
  
  print("test_CleanRawData cleaned data ###########################")
  print(head(cleanData))

  print("###########################################################")

  return (cleanData)
}

```

```{r}

test_TransformRawToBase <- function(url, datafile) {
  rawData   <- LoadStormCostData(datafile)
  cleanData <- CleanRawData(rawData)
  baseData  <- TransformRawToBase(cleanData)
  
  print("test_TransformRawToBase transformed data ###############")
  print(head(baseData))
  print("###########################################################")

  return (baseData)
}

```

```{r}

test_MakeBaseTables <- function(url, datafile) {
  rawData <- LoadStormCostData(datafile)
  cleanData <- CleanRawData(rawData)
  baseData <- TransformRawToBase(cleanData)
  baseTableList <- MakeBaseTableList(baseData)
  
  print("test_MakeBaseTables source disaster list ###########")
  for (baseTable in baseTableList) {
    print(head(baseTable))
  }

  return (baseTableList)
}

```
#### TEST Get Human Cost
```{r}
test_GetHumanCost <- function(url, datafile) {
  rawData <- LoadStormCostData(datafile)
  cleanData <- CleanRawData(rawData)
  baseData <- TransformRawToBase(cleanData)
  baseTableList <- MakeBaseTableList(baseData)
  humanCost <- GetHumanCost(baseTableList)
  
  print("test_GetHumanCost ###########")
  print("test_GetHumanCost: base data ---------")
  print(head(baseData, n = 3))
  
  print("test_GetHumanCost: base table ---------")
  for (baseTable in baseTableList) {
    print(head(baseTable, n = 3))
  }
  print("test_GetHumanCost: cost table ---------")
  for (cost in humanCost) {
    print(head(cost, n = 3))
  }

}
```

```{r}

test_MergeStormLists <- function(url, datafile) {
  rawData <- LoadStormCostData(datafile)
  cleanData <- CleanRawData(rawData)
  baseData <- TransformRawToBase(cleanData)
  baseTableList <- MakeBaseTableList(baseData)
  mergedTableList <- MergeStormLists(baseTableList)
  
  print("test_MakeMergedTable jurisdiction disaster list ######")
  i = 1
  for (mergedTable in mergedTableList) {
    print(paste0("List[", i, "]"))
    print(head(mergedTable))
    i = i + 1
  }
}

```

```{r}

test_makeJurisStormList <- function(url, datafile) {
  rawData        <- LoadStormCostData(url, datafile)
  cleanData      <- CleanRawData(rawData)
  baseData       <- TransformRawToBase(cleanData)
  baseTableList  <- MakeBaseTableList(baseData)
  jurisTableList <- MakeJurisMergedTable(baseTableList)

    i = 1
  for (jurisTable in jurisTableList) {
    print(paste0("List[", i, "]"))
    print(head(jurisTable[[juris]]))
    i = i + 1
  }
}

```

```{r}

test_MakeStormCostTables <- function(url, datafile) {
  jurisTableList <- MakeStormCostTables(url, datafile)

    i = 1
  for (jurisTable in jurisTableList) {
    print(paste0("List[", i, "]"))
    print(head(jurisTable))
    i = i + 1
  }
}

```

```{r}
# 
# runDataTest <- function()
# {
#   rawData         <- test_LoadStormCostData()
#   cleanData       <- test_CleanRawData(rawData)
#   baseData        <- test_TransformRawToBase(cleanData)
#   baseTableList   <- test_MakeBaseTables(baseData)
#   jurisTableList  <- test_jurisStormTable(baseTableList)
# }

```

```{r}
# 
# if (SYSTEM & PHASE_MAKE_DATA) {
#   jurisTableList <- MakeStormCostTables(URL, DATAFILE)
#   i = 1
#   for (jurisTable in jurisTableList) {
#     print(paste0("List[", i, "]"))
#     print(head(jurisTable))
#     i = i + 1
#   }
# }

```

```{r}
# ###################################################################
# test_MakeTop10HumanTable <- function(jurisTableList) {
#   humanCostsTable <- MakeTop10HumanTable(jurisTableList)
#   i = 1
#   for (humanTable in humanCostsTable) {
#     print(paste0("List[", i, "]"))
#     if (i %% 2 == 0) {
#       tbl <- data.frame(humanTable)
#       print(class(tbl))
#       print(head(tbl))
#     } else {
#       print(humanTable)
#     }
#     
#     i = i + 1
#   }
# }

```

```{r}

# test_MakeTop10EconomicTable <- function(jurisTableList) {
#   economicCostsTable <- MakeTop10EconomicTable(jurisTableList)
#   i = 1
#   for (economicTable in economicCostsTable) {
#     print(paste0("List[", i, "]"))
#     if (i %% 2 == 0) {
#       tbl <- data.frame(economicTable)
#       print(class(tbl))
#       print(head(tbl))
#     } else {
#       print(economicTable)
#     }
#     i = i + 1
#   }
# }

```

```{r}

if (TEST & MAKE_STORM_COST_TABLES){
  test_MakeStormCostTables(URL, DATAFILE)
}

if (TEST & LOAD_STORM_COST_DATA){
  test_LoadStormCostData(URL, DATAFILE)
}

if (TEST & CLEAN_RAW_DATA){
  test_CleanRawData(URL, DATAFILE)
}

if (TEST & TRANSFORM_RAW_TO_BASE){
  test_TransformRawToBase(URL, DATAFILE)
}

if (TEST & MAKE_BASE_TABLE_LIST){
  test_MakeBaseTables(URL, DATAFILE)
}

if (TEST & MAKE_JURIS_MERGED_TABLE){
  # test_MakeBaseTables(URL, DATAFILE)
}

if (TEST & GET_HUMAN_COST){
  test_GetHumanCost(URL, DATAFILE)
}

  
  
if (TEST & MERGE_STORM_LIST){
  test_MergeStormLists(URL, DATAFILE)
}
# 
# if (TEST & GET_HUMAN_COST){
#   jurisTableList  <- test_jurisStormTable(URL, DATAFILE)
# }

```

<!-- GET_ECONOMIC_COST              = FALSE -->
<!-- MERGE_STORM_LIST              = FALSE -->
<!-- MAKE_JURIS_MERGED_TABLE    = FALSE -->

<!-- MAKE_STORM_COST_ANALYSIS   = FALSE -->
<!-- MAKE_TOP10_HUMAN_TABLE     = FALSE -->
<!-- MAKE_TOP10_ECONOMCIC_TABLE = FALSE -->
<!-- MAKE_CVC_IMAGE             = FALSE -->


```{r}
# 
# 
# if (SYSTEM & PHASE_MAKE_DATA) {
#   rawData         <- test_LoadStormCostData()
#   cleanData       <- test_CleanRawData(rawData)
#   baseData        <- test_TransformRawToBase(cleanData)
#   baseTableList   <- test_MakeBaseTables(baseData)
#   jurisTableList  <- test_jurisStormTable(baseTableList)
# }

```

# visualization tests

```{r visualization test}
# 
# test_MakeCvC <- function(jurisTableList) {
#   humanList <- MakeTop10HumanTable(jurisTableList)
#   cvcImages <- MakeCvC(humanList)
# 
#   print(paste0("number of images = ", length(cvcImages)))
# 
#   i = 1
#   # plot(cvcImages[[1]])
# 
#   for (cvcImage in cvcImages) {
#     print(class(cvcImage))
# 
#     print(paste0("image[", i, "]"))
#     plot(cvcImage)
#     # dev.off()
#     i = i + 1
#   }
# }

```

```{r}
# 
# if (SYSTEM & PHASE_ANALYSIS) {
#   jurisTableList <- MakeStormCostTables(URL, DATAFILE)
#   resultList      <- MakeStormCostAnalysis(jurisTableList)
#   i = 1
#   for (jurisTable in resultList) {
#     print(paste0("List[", i, "]"))
#     print(head(jurisTable))
#     i = i + 1
#   }
# }
# 
# ```
# 
# ```{r}
# 
# if (TEST & PHASE_ANALYSIS) {
#   jurisTableList <- MakeStormCostTables(URL, DATAFILE)
#   if (MAKE_TOP10_HUMAN_TABLE) {
#     humanList       <- test_MakeTop10HumanTable(jurisTableList)
#   }
#   if (MAKE_TOP10_ECONOMCIC_TABLE) {
#     econList       <- test_MakeTop10EconomicTable(jurisTableList)
#   }
#   if (MAKE_CVC_IMAGE) {
#     cvcImages      <- test_MakeCvC(jurisTableList)
#   }
# }

```

```{r}

# if (DISPLAY_OUTPUT) {
#   jurisTableList <- MakeStormCostTables(URL, DATAFILE) 
#   tableSet <- makeOutputTables(jurisTableList[[US_BASE_IDX]])
#   tableSet
# }

```
